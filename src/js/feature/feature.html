<app-header></app-header>

<section class="container feature-detail">
  <div class="row">
    <div class="col-sm-8 feature-header">
      <div class="section">
        <div class="row">
          <div class="col-sm-12">
            <h1>
              {{::$ctrl._feature.subject}}
              <small class="value">{{$ctrl._featureDetail.totalValue | currency }}</small>
            </h1>
          </div>
        </div>
        <div class="row mb-xs"
          ng-show="$ctrl._feature.labels">
          <div class="col-sm-12">
            <span ng-repeat="label in $ctrl._feature.labels" class="label label-default mr-xs" >{{label}}</span>
            </div>
        </div>
        <div class="row"
          ng-show="$ctrl._feature.compGap || $ctrl._feature.legacyGap">
          <div class="col-sm-12">
            <span class="label label-danger mr-xs"
              ng-show="$ctrl._feature.compGap">Competitive Gap</span>
            <span class="label label-danger mr-xs"
              ng-show="$ctrl._feature.legacyGap">Legacy Gap</span>
          </div>
        </div>
      </div>
      <div class="row section">
        <div class="col-sm-12">
          <div class="section-header"
            ng-class="{'closed':!$ctrl.showOgRequest}"
            ng-click="$ctrl.showOgRequest = !$ctrl.showOgRequest">
            <h4>Original Request</h4>
          </div>
          <div class="col-sm-12"
            ng-show="$ctrl.showOgRequest">
            <p>{{$ctrl._feature.description}}</p>
            <div ng-show="$ctrl.userIsAdmin">admin</div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-12">

          <div class="section-header"
            ng-class="{'closed':!$ctrl.showComments}"
            ng-click="$ctrl.showComments = !$ctrl.showComments">
            <h4>Comments</h4>
          </div>

          <div class="col-sm-12"
            ng-show="$ctrl.showComments">

            <comment ng-repeat="cmt in $ctrl._comments"
              data="cmt"
              delete-cb="$ctrl.deleteComment(cmt.$id, $index)">
            </comment>
            
            <form class="message-form"
              ng-show="$ctrl.showComment"
              ng-submit="$ctrl.addComment()">

              <div class="form-group">
                <textarea class="form-control" rows="3"
                  ng-model="$ctrl.comment.message">
                </textarea>
              </div>
              <button class="btn btn-default"
                ng-click="$ctrl.resetComment()" type="button">Cancel</button>
              <button class="btn btn-info" type="submit">Add Comment</button>

            </form>
            <button class="btn btn-default"
              ng-hide="$ctrl.showComment"
              ng-click="$ctrl.showComment = true">Comment
            </button>
          </div>
          

        </div>
      </div>
    </div>
    <div class="col-sm-4 feature-sidebar">
      <ul class="list-unstyled mt-xl">
        <li><strong>Status:</strong>  <status 
          data="$ctrl._feature.status"></status>
        </li>
        <li>
          <strong>Requested by:</strong><br>
          {{::$ctrl._featureDetail.requester.firstName}} {{::$ctrl._featureDetail.requester.lastName}}<br>
          <em ng-show="$ctrl._featureDetail.requester.department">{{::$ctrl._featureDetail.requester.department}}</em><br>
          <a href="mailto:{{::$ctrl._featureDetail.requester.email}}">{{::$ctrl._featureDetail.requester.email}}</a>
        </li>
        <li><strong>Requested for:</strong> {{$ctrl._featureDetail.accountsMeta[0].name}}</li>
      </ul>
    </div>
  </div>
</section>


<section class="container">

  
</section>

<section class="container">
  <!--todo: make this modular-->
  <!--<a class="btn btn-info pull-right mt-lg"
    ui-sref="app.add-customer">
    Add Customer
  </a>-->
  <div class="section-header"
    ng-class="{'closed':!$ctrl.showCustomerSummary}"
    ng-click="$ctrl.showCustomerSummary = !$ctrl.showCustomerSummary">
    <h4>Customer Summary</h4>
  </div>
  <div class="col-sm-12"
    ng-show="$ctrl.showCustomerSummary">
    <table class="table table-striped">
      <thead>
        <th>Account Name</th>
        <th>Account ID</th>
        <th>Type</th>
        <th>Platform</th>
        <th>Country</th>
        <th class="text-right">Account Value</th>
      </thead>
      <tbody>
        <tr ng-repeat="account in $ctrl._featureDetail.accountsMeta">
          <td>{{account.name}}</td>
          <td>{{account.cid}}</td>
          <td>{{account.accountType}}</td>
          <td>{{account.platform}}</td>
          <td>{{account.country}}</td>
          <td align="right">{{account.value | currency}}</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <div class="col-sm-6"
    ng-show="$ctrl.showAccountForm">
    <form class="account-form" 
      ng-submit="$ctrl.addAccount()">
      
      <fieldset class="account-form"
        ng-disabled="$ctrl.accountForm.isSubmitting">

        <!-- existing account -->
        <div ng-if="!$ctrl.new">
          <ul class="list-unstyled">
            <li ng-repeat="account in $ctrl.existingAccountsMeta track by $index">{{ account.name }} <span class="meta">&mdash; {{ account.cid }}</span> <i ng-click="$ctrl.removeAccountFromAddList($index)" class="ion-close-circled"></i></li>
          </ul>
          <div class="form-group">
            <label for="lookup" class="control-label">Account:</label>
            <div angucomplete-alt id="ex2"
              placeholder="Enter account name or ID"
              pause="300"
              clear-selected="true"
              selected-object="$ctrl.accountSelected"
              local-data="$ctrl._Accounts.all"
              local-search="$ctrl._Accounts.accountSearch"
              title-field="name"
              description-field="cid"
              minlength="1"
              input-class="form-control form-control-small"
              match-class="highlight">
            </div>
          </div>
          <input type="hidden" ng-init="$ctrl.accountForm.selectedAccounts = []">

          Can't find your customer? <a ng-click="$ctrl.new = true" class="btn btn-link">Click here.</a> 
          <button type="submit" class="btn btn-info pull-right">Add Customer</button>
          <button class="btn btn-default pull-right mr-sm"
            ng-click="$ctrl.resetAccountForm()" type="button">Cancel</button>
          
        </div>

        <!-- new account -->
        <div ng-if="$ctrl.new">
          <div class="form-group">
            <label for="account-name" class="control-label">Account Name</label>
            <input type="text" class="form-control" id="account-name"
              ng-model="$ctrl.accountForm.name">
          </div>
          <div class="form-group">
            <label for="cision-point-id" class="control-label">Account ID</label>
            <input type="text" class="form-control" id="cision-point-id"
              ng-model="$ctrl.accountForm.cid">
            <div class="col-sm-10">
            </div>
          </div>
          <div class="form-group">
            <label for="account-type" class="control-label">Platform</label>
            <select class="form-control" 
              ng-model="$ctrl.accountForm.platform">
              <option>PRN customer on the OMC</option>
              <option>MV (and wonâ€™t upgrade)</option>
              <option>Net new C3 customer (no legacy platform)</option>
              <option>On C3 (upgraded from CPRE)</option>
              <option>On C3 (upgraded from CP)</option>
              <option>On C3 (upgraded from MyG)</option>
              <option>On C3 (upgraded from PRWeb subscription)</option>
              <option>On C3 (upgraded from PRN Agility)</option>
              <option>On CPRE (and won't upgrade)</option>
              <option>On CP (and won't upgrade)</option>
              <option>On MyG (and won't upgrade)</option>
              <option>PRWeb subscription (and won't upgrade)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="account-type" class="control-label">Country</label>
            <select class="form-control" 
              ng-model="$ctrl.accountForm.country">
              <option>USA</option>
              <option>UK</option>
              <option>Canada</option>
              <option>Germany</option>
              <option>France</option>
              <option>Nordics</option>
              <option>LatAm</option>
              <option>Asia</option>
              <option>Other</option>
            </select>
          </div>
          <div class="form-group">
            <label for="account-type" class="control-label">Account Type</label>
            <select class="form-control" 
              ng-model="$ctrl.accountForm.accountType">
              <option>Current customer</option>
              <option>Lost customer</option>
              <option>Prospect in-cycle</option>
              <option>Prospect loss</option>
            </select>
          </div>
          <div class="form-group">
            <label for="account-value" class="control-label">Account Value</label>
            <div class="input-group">
              <div class="input-group-addon">$</div>
              <input type="text" class="form-control" id="account-value"
                ng-model="$ctrl.accountForm.value">
            </div>
          </div>
          Is your customer already in our database? <a ng-click="$ctrl.new = false" class="btn btn-link">Click here.</a> 
          <button type="submit" class="btn btn-info pull-right">Add Customer</button>
          <button class="btn btn-default pull-right mr-sm"
            ng-click="$ctrl.resetAccountForm()" type="button">Cancel</button>
        </div>
      </fieldset>
      
    </form>
  </div>
  <div class="col-sm-6">
    <button type="button" class="btn btn-default"
      ng-hide="$ctrl.showAccountForm"
      ng-click="$ctrl.showAccountForm = true">Add Customer to Request
    </button>
  </div>
</section>